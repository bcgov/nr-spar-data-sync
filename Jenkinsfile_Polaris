@Library('polaris')
import ca.bc.gov.nrids.polaris.Podman
import ca.bc.gov.nrids.polaris.BrokerIntention
import ca.bc.gov.nrids.polaris.Vault

def podman

pipeline {
    agent none 
	environment {
        vtoken = credentials('VTOKEN')
		teste = '123'
    }
    stages {
         stage('Checkout code') {
			agent {
                label Podman.AGENT_LABEL_APP
            }
		 	steps {
				checkout scm
			}
		 }
		 stage('Run Compose') {
			agent {
                label Podman.AGENT_LABEL_APP
            }
		 	steps {
				sh 'pwd'
				sh 'dir'
				sh 'echo $teste'
				sh 'echo $vtoken'
				sh 'echo "podman build --build-arg=vtoken=$vtoken --build-arg=teste=$teste --file=Dockerfile_Polaris ."'
			}
		 }
		 
		 stage('Run Podman') {
			agent {
                label Podman.AGENT_LABEL_APP
            }
		 	steps {
				script{
					podman = new Podman(this,env)
					podman.build('', '--file=Dockerfile_Polaris .')
				}
			}
		 }
    }
}

 